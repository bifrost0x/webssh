##############################################
# Web SSH Terminal - All-in-One Docker Compose
#
# No .env file needed - edit values directly below
#
# BEFORE RUNNING:
# 1. Replace <YOUR-SECRET-KEY> with output of: openssl rand -hex 32
# 2. Set CORS_ORIGINS to your domain (e.g. https://ssh.example.com)
#    For homelab without TLS: http://your-server-ip:5000
#    For wildcard (insecure): CORS_ORIGINS=* and ALLOW_CORS_WILDCARD=true
##############################################

services:
  webssh:
    image: ghcr.io/bifrost0x/webssh:latest
    container_name: webssh
    restart: unless-stopped
    ports:
      - "5000:5000"
    environment:
      # === REQUIRED: Generate with: openssl rand -hex 32 ===
      - SECRET_KEY=<YOUR-SECRET-KEY>

      # === CORS: Wildcard default for homelab use ===
      # For production: replace * with your domain (e.g. https://ssh.example.com)
      # and remove ALLOW_CORS_WILDCARD
      - CORS_ORIGINS=*
      - ALLOW_CORS_WILDCARD=true

      # === Set to 1 if behind reverse proxy (Traefik, nginx, etc.) ===
      - TRUSTED_PROXIES=0

      # === Set to false if accessing via HTTP without TLS ===
      - SESSION_COOKIE_SECURE=false

      # === Optional: Usually no changes needed ===
      - DEBUG=False
      - HOST=0.0.0.0
      - PORT=5000
      - DATA_DIR=/app/data
    volumes:
      - webssh_data:/app/data
    healthcheck:
      test: ["CMD", "python", "-c", "import socket; s=socket.create_connection(('127.0.0.1', 5000), 2); s.close()"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

volumes:
  webssh_data:
    driver: local
